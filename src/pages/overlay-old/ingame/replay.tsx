import { useWS } from '@/contexts/ws'
import { DEFAULT_GOAL, GoalScored } from '@models/ingame/events/GoalScored'
import gsap from 'gsap'
import { createSignal, onMount } from 'solid-js'

const Replay = () => {
  const [goal, setGoal] = createSignal<GoalScored>(DEFAULT_GOAL)

  const repetitionX = 95
  const repetitionY = 90

  const scorerX = 680
  const scorerY = 146

  const speedX = 1100
  const speedY = 146

  let replayRef: SVGSVGElement | null
  const setReplayRef = (el: SVGSVGElement) => {
    replayRef = el
  }

  const enter = () => gsap.to(replayRef, { y: 0, ease: 'power2.out', duration: 1 })
  const exit = () => gsap.to(replayRef, { y: 190, ease: 'power2.out', duration: 1 })
  const initial = () => gsap.set(replayRef, { y: 190 })

  const ws = useWS()
  ws.subscribe('game', 'goal_scored', (data: unknown) => {
    const goalData = data as GoalScored
    setGoal(goalData)
  })
  ws.subscribe('game', 'replay_start', () => {
    enter()
  })
  ws.subscribe('game', 'replay_end', () => {
    exit()
  })

  onMount(() => {
    initial()
  })

  return (
    <svg
      ref={setReplayRef}
      class="absolute bottom-0 left-0 w-[1920px] h-[190px]"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 1920 190"
    >
      <defs>
        <filter
          id="red-glow"
          filterUnits="userSpaceOnUse"
          x="-50%"
          y="-50%"
          width="200%"
          height="200%"
        >
          <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="blur5" />
          <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur10" />
          <feGaussianBlur in="SourceGraphic" stdDeviation="20" result="blur20" />
          <feGaussianBlur in="SourceGraphic" stdDeviation="30" result="blur30" />
          <feGaussianBlur in="SourceGraphic" stdDeviation="50" result="blur50" />
          <feMerge result="blur-merged">
            <feMergeNode in="blur10" />
            <feMergeNode in="blur20" />
            <feMergeNode in="blur30" />
            <feMergeNode in="blur50" />
          </feMerge>
          <feColorMatrix
            result="red-blur"
            in="blur-merged"
            type="matrix"
            values="1 0 0 0 0
                    0 0 0 0 0
                    0 0 0 0 0
                    0 0 0 1 0"
          />
          <feMerge>
            <feMergeNode in="red-blur" />
            <feMergeNode in="blur5" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>
      <path
        fill="#161616"
        opacity={0.95}
        d="M0,190h1920V0l-350,30-35,50s-138,20-575,20-575-20-575-20l-35-50L0,0v190Z"
      />
      <g transform="rotate(4 90 100)">
        <circle
          cx={repetitionX - 24}
          cy={repetitionY - 4}
          r={10}
          fill="#ff6f6f"
          filter='url("#red-glow")'
        />
        <text
          font-family="NK57 Monospace NO"
          font-weight={300}
          x={repetitionX}
          y={repetitionY}
          font-size="30"
          fill="#ff6f6f"
          filter='url("#red-glow")'
          dominant-baseline="middle"
        >
          REPETICIÃ“N
        </text>
      </g>
      <g transform={`translate(${scorerX - 58} ${scorerY - 21})`}>
        <path
          data-name="goal-icon"
          fill="#eeeeee"
          transform="scale(0.12)"
          d="M351.56,254.91,278,183.83l29.07-24.51-28.72-25.21,33.27-48-58.83,5.25L276.62,0,210.79,65.13l-25.21-35L160.37,64.78,97.34,7l21,85.09-38.86,3.5,14,38.17L0,159.32l91,25.21L68.28,226.9l48.67.7L80.54,340l79.83-87.19L185.58,339l25.21-86.49,43.77,25.91-2.45-51.47Zm-182-69h29.18a6,6,0,0,1,4.81,2.45l4.47,6.16a5.94,5.94,0,0,1,.85,5.32l-8.44,26a6,6,0,0,1-5.65,4.1H173.51a6,6,0,0,1-5.65-4.1l-8.43-26a5.91,5.91,0,0,1,.84-5.32l4.47-6.16A6,6,0,0,1,169.55,185.9ZM158,151.09a4.43,4.43,0,0,1,1.61-5l21.9-15.91a4.44,4.44,0,0,1,5.22,0l21.9,15.91a4.43,4.43,0,0,1,1.61,5l-8.36,25.74a4.44,4.44,0,0,1-4.23,3.07H170.61a4.45,4.45,0,0,1-4.23-3.07Zm49.62,34.37a5.94,5.94,0,0,1-.85-5.32l8.86-27.25a5.93,5.93,0,0,1,3.81-3.81l7-2.29a5.94,5.94,0,0,1,5.32.85l21.66,15.73a6,6,0,0,1,2.16,6.64l-6.43,19.79a5.93,5.93,0,0,1-5.64,4.1H216.79a5.93,5.93,0,0,1-4.8-2.45Zm50.11,18.08a1.61,1.61,0,0,1-2.89-.36l-2-6.2a1.7,1.7,0,0,1,0-1l9.44-29.06a1.62,1.62,0,0,1,.59-.8l5.3-3.85a1.61,1.61,0,0,1,2.55,1.41A86.15,86.15,0,0,1,257.75,203.54Zm-4.44-93.64a5.94,5.94,0,0,1,5.07,2.85,86.13,86.13,0,0,1,12.25,37.58,6,6,0,0,1-2.43,5.31L263.64,159a5.94,5.94,0,0,1-7,0l-20.14-14.63a5.93,5.93,0,0,1-2.16-6.64L242.05,114a6,6,0,0,1,5.65-4.1ZM216.69,77.61a87.09,87.09,0,0,1,33.86,24.64,1.61,1.61,0,0,1-1.23,2.65h-6.5a1.58,1.58,0,0,1-.94-.31l-24.72-18a1.62,1.62,0,0,1-.59-.8l-2-6.23A1.61,1.61,0,0,1,216.69,77.61Zm.62,15.79,16.83,12.23a5.94,5.94,0,0,1,2.16,6.63L228,137.72a5.93,5.93,0,0,1-3.81,3.82l-7,2.28a5.91,5.91,0,0,1-5.32-.84l-23.18-16.84a5.92,5.92,0,0,1-2.45-4.8v-7.41a5.93,5.93,0,0,1,2.45-4.8L210.33,93.4A5.91,5.91,0,0,1,217.31,93.4Zm-59-11L160.1,77a5.89,5.89,0,0,1,4.25-3.94,87,87,0,0,1,39.58,0A5.92,5.92,0,0,1,208.19,77l1.74,5.37A5.94,5.94,0,0,1,207.77,89l-20.14,14.64a5.94,5.94,0,0,1-7,0L160.51,89A5.94,5.94,0,0,1,158.35,82.39Zm20.43,26.74a6,6,0,0,1,2.44,4.8v7.41a5.94,5.94,0,0,1-2.44,4.8L155.6,143a5.91,5.91,0,0,1-5.32.84l-7.05-2.28a6,6,0,0,1-3.81-3.82l-8.27-25.46a5.92,5.92,0,0,1,2.15-6.63L150.14,93.4a5.9,5.9,0,0,1,7,0Zm-61-6.88a87.09,87.09,0,0,1,33.86-24.64,1.61,1.61,0,0,1,2.14,2l-2,6.23a1.62,1.62,0,0,1-.59.8l-24.72,18a1.58,1.58,0,0,1-.94.31H119A1.61,1.61,0,0,1,117.73,102.25ZM97.66,150.33a86.25,86.25,0,0,1,12.24-37.58A5.94,5.94,0,0,1,115,109.9h5.61a6,6,0,0,1,5.65,4.1l7.69,23.68a5.93,5.93,0,0,1-2.15,6.64L111.62,159a5.91,5.91,0,0,1-7,0l-4.55-3.31A5.92,5.92,0,0,1,97.66,150.33ZM115.44,197l-2,6.2a1.61,1.61,0,0,1-2.89.36,86.15,86.15,0,0,1-13-39.86,1.61,1.61,0,0,1,2.55-1.41l5.3,3.85a1.62,1.62,0,0,1,.59.8L115.44,196A1.7,1.7,0,0,1,115.44,197Zm-2.8-27a6,6,0,0,1,2.16-6.64l21.66-15.73a5.94,5.94,0,0,1,5.32-.85l7,2.29a5.93,5.93,0,0,1,3.81,3.81l8.86,27.25a5.94,5.94,0,0,1-.85,5.32l-4.35,6a5.93,5.93,0,0,1-4.8,2.45H124.72a5.94,5.94,0,0,1-5.65-4.1Zm48.16,63.31-4.56,3.31a5.92,5.92,0,0,1-5.8.66A87.06,87.06,0,0,1,118.5,214a5.94,5.94,0,0,1-1.16-5.72l1.73-5.31a5.94,5.94,0,0,1,5.65-4.1h24.89a5.94,5.94,0,0,1,5.65,4.1L163,226.68A5.93,5.93,0,0,1,160.8,233.32Zm44.32,8.61a86.88,86.88,0,0,1-42,0,1.61,1.61,0,0,1-.56-2.87l5.31-3.85a1.58,1.58,0,0,1,.94-.31h30.56a1.58,1.58,0,0,1,.94.31l5.31,3.85A1.61,1.61,0,0,1,205.12,241.93ZM249.78,214a87.06,87.06,0,0,1-31.94,23.26,5.92,5.92,0,0,1-5.8-.66l-4.56-3.31a5.93,5.93,0,0,1-2.15-6.64L213,203a5.94,5.94,0,0,1,5.65-4.1h24.9a5.93,5.93,0,0,1,5.64,4.1l1.73,5.31A5.94,5.94,0,0,1,249.78,214Z"
        />
      </g>
      <text
        font-family="Chivo"
        font-style="italic"
        x={scorerX}
        y={scorerY}
        font-size="24"
        fill="#eeeeee"
        dominant-baseline="middle"
      >
        {goal().scorer.name}
      </text>
      <g transform={`translate(${speedX - 56} ${speedY - 25})`}>
        <path
          data-name="speed-icon"
          fill="#eeeeee"
          transform="scale(0.12)"
          d="M25.51,58.17C-3.79,48,.18,0,.18,0s20,43,51.64,46c19,1.83,30,33.5,24.35,67.83C71,101.56,50.51,66.83,25.51,58.17ZM53.18,176.44c-5.67,20.12,5.45,65,51.22,84.34,0,0-10.55-12.89-11.69-22.36C91.61,229.22,66.63,227.22,53.18,176.44Zm83.33-102c5.34,36.12,31.34,46.67,42.89,46.67-20.46-7.28-10-8.07-26.44-51.67-19.67-52-65.89-39.11-65.89-39.11S130.24,32,136.51,74.44ZM314.85,231A104,104,0,0,1,108.3,248.34c-8-13.44-18.91-18.47-24.12-34.34-11.46-34.93-7.59-45.38-31.67-52.33-22.33-6.45-27-48.67-27-48.67S40.25,145,70.18,149.33c12.89,1.89,21.3,26.47,30,34.67,9.56,9,27.78-11,15.67-17.33-18.18-9.51-30.4-17.68-33-42.67-1.89-18.11,5-36.67-1.67-54.67-11-29.66-33-38-33-38s56.49,3.33,57.33,60c.67,44.78,34.93,60.78,45.67,54.67,5.67-3.22-1.67-13.11-18.67-24.5C117.94,111.74,118.18,66,118.18,66s25,69.8,71.82,63.09c40.18-5.76-7.82-24.42-7.82-24.42s12.57-6.27,30.67.66c18.65,7.15,16.75,16.66,20.74,24.17A104,104,0,0,1,314.85,231Zm-37.49-50a6.24,6.24,0,0,0-5.92,4.3l-8.07,24.84a6.25,6.25,0,0,0,2.26,7l21.13,15.35a6.24,6.24,0,0,0,7.32,0l4.79-3.48a6.22,6.22,0,0,0,2.54-5.57A90.33,90.33,0,0,0,288.57,184a6.23,6.23,0,0,0-5.32-3Zm-99.72,45a6.25,6.25,0,0,0-4-4l-7.39-2.4a6.24,6.24,0,0,0-5.58.89L137.94,237a6.23,6.23,0,0,0-2.26,7l6.75,20.76a6.22,6.22,0,0,0,5.92,4.3h28.09a6.2,6.2,0,0,0,5-2.57l4.57-6.28a6.23,6.23,0,0,0,.88-5.59Zm5.64-1.2,8.78,27a4.65,4.65,0,0,0,4.43,3.22h28.39a4.67,4.67,0,0,0,4.44-3.22l8.77-27a4.67,4.67,0,0,0-1.69-5.22l-23-16.69a4.68,4.68,0,0,0-5.48,0l-23,16.69A4.67,4.67,0,0,0,183.28,224.78Zm1.57,50.79,8.82,27.13a6.22,6.22,0,0,0,5.92,4.3h22.2a6.22,6.22,0,0,0,5.92-4.3l8.81-27.13a6.21,6.21,0,0,0-.88-5.58L231,263.57a6.2,6.2,0,0,0-5-2.57h-30.5a6.23,6.23,0,0,0-5,2.57L185.74,270A6.24,6.24,0,0,0,184.85,275.57Zm55.05-9.14a6.23,6.23,0,0,0,5,2.57H273a6.22,6.22,0,0,0,5.92-4.3l6.74-20.76a6.2,6.2,0,0,0-2.26-7l-22.72-16.51a6.24,6.24,0,0,0-5.58-.89l-7.39,2.4a6.25,6.25,0,0,0-4,4l-9.29,28.58a6.26,6.26,0,0,0,.89,5.59Zm2.69-118,2.12,6.53a1.75,1.75,0,0,0,.61.85l25.94,18.84a1.67,1.67,0,0,0,1,.32h6.82a1.69,1.69,0,0,0,1.29-2.78,91.54,91.54,0,0,0-35.52-25.85A1.7,1.7,0,0,0,242.59,148.46Zm-4.45,15L215.41,180a6.22,6.22,0,0,0-2.56,5v7.77a6.22,6.22,0,0,0,2.56,5l24.32,17.67a6.21,6.21,0,0,0,5.58.88l7.39-2.4a6.21,6.21,0,0,0,4-4l8.68-26.71a6.24,6.24,0,0,0-2.26-7l-17.66-12.83A6.24,6.24,0,0,0,238.14,163.46Zm-52.24-4.58L207,174.23a6.24,6.24,0,0,0,7.32,0l21.13-15.35a6.23,6.23,0,0,0,2.26-7l-1.83-5.63a6.18,6.18,0,0,0-4.46-4.13,91.36,91.36,0,0,0-41.52,0,6.19,6.19,0,0,0-4.47,4.13l-1.82,5.63A6.22,6.22,0,0,0,185.9,158.88Zm-10.66,4.58-17.66,12.83a6.22,6.22,0,0,0-2.26,7L164,210a6.2,6.2,0,0,0,4,4l7.39,2.4a6.23,6.23,0,0,0,5.59-.88l24.31-17.67a6.23,6.23,0,0,0,2.57-5V185a6.23,6.23,0,0,0-2.57-5l-22.72-16.51A6.24,6.24,0,0,0,175.24,163.46ZM142.31,175h6.82a1.69,1.69,0,0,0,1-.32l25.93-18.84a1.7,1.7,0,0,0,.62-.85l2.12-6.53a1.7,1.7,0,0,0-2.25-2.09A91.54,91.54,0,0,0,141,172.22,1.69,1.69,0,0,0,142.31,175Zm-19.8,54,4.78,3.48a6.24,6.24,0,0,0,7.32,0l21.14-15.35a6.25,6.25,0,0,0,2.26-7l-8.07-24.84A6.25,6.25,0,0,0,144,181h-5.88a6.23,6.23,0,0,0-5.32,3A90.47,90.47,0,0,0,120,223.41,6.25,6.25,0,0,0,122.51,229Zm16.11,42.1-9.91-30.49a1.7,1.7,0,0,0-.61-.84l-5.56-4a1.69,1.69,0,0,0-2.68,1.48A90.4,90.4,0,0,0,133.47,279a1.69,1.69,0,0,0,3-.38l2.12-6.51A1.68,1.68,0,0,0,138.62,271.08Zm49.84,32.06-8.07-24.84a6.22,6.22,0,0,0-5.92-4.3H148.35a6.22,6.22,0,0,0-5.92,4.3l-1.81,5.58a6.21,6.21,0,0,0,1.21,6,91.58,91.58,0,0,0,33.5,24.4,6.24,6.24,0,0,0,6.09-.7l4.78-3.47A6.23,6.23,0,0,0,188.46,303.14Zm44.82,13.23-5.57-4.05a1.69,1.69,0,0,0-1-.32H194.66a1.69,1.69,0,0,0-1,.32l-5.57,4.05a1.69,1.69,0,0,0,.59,3,91,91,0,0,0,44,0A1.69,1.69,0,0,0,233.28,316.37Zm47.48-32.49L279,278.3A6.22,6.22,0,0,0,273,274H246.91a6.22,6.22,0,0,0-5.92,4.3l-8.08,24.84a6.24,6.24,0,0,0,2.27,7l4.77,3.47a6.26,6.26,0,0,0,6.1.7,91.58,91.58,0,0,0,33.5-24.4A6.23,6.23,0,0,0,280.76,283.88Zm7.15-4.87a90.51,90.51,0,0,0,13.61-41.82,1.69,1.69,0,0,0-2.68-1.48l-5.56,4a1.7,1.7,0,0,0-.61.84l-9.91,30.49a1.68,1.68,0,0,0,0,1l2.11,6.51A1.69,1.69,0,0,0,287.91,279Z"
        />
      </g>
      <text
        font-family="Chivo"
        font-style="italic"
        x={speedX}
        y={speedY}
        font-size="24"
        fill="#eeeeee"
        dominant-baseline="middle"
      >
        {Math.round(goal().goalspeed)} km/h
      </text>
    </svg>
  )
}

export { Replay }
